<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>CHEMONE 품목 조회</title>
  <link rel="icon" href="C-favicon.ico" type="image/x-icon" />
  <style>
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --line: #e5e7eb;
      --brand: #1e40af;
      --muted: #6b7280;
      --badge-bg: #eef2ff;
      --badge-bd: #c7d2fe;
      --badge-fg: #3730a3;
      --danger-bg: #ffe4e6;
      /* 더 밝은 핑크 */
      --danger-fg: #ef4444;
      /* 더 선명한 빨강 */
      --row-base: #fcfcfd;
      /* 모든 행 기본 배경 */
      --row-hover: #f3f4f6;
      --radius: 10px;
      --pad: 12px;
      --table-font: 0.92rem;
      --btn-h: 42px;
      /* 버튼/입력 높이 통일 */
    }

    @font-face {
      font-family: 'BladeRunner';
      src: url('blade_runner.ttf') format('truetype');
    }

    @font-face {
      font-family: 'NanumSquareNeo';
      src: url(https://hangeul.pstatic.net/hangeul_static/webfont/NanumSquareNeo/NanumSquareNeoTTF-bRg.woff) format("woff");
    }

    body {
      font-family: 'NanumSquareNeo', sans-serif;
      background: var(--bg);
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
      color: #111827;
    }

    h1 {
      text-align: center;
      font-size: clamp(1.4rem, 2.2vw, 2rem);
      cursor: pointer;
      margin: 0 0 1rem;
    }

    .chemone {
      font-family: 'BladeRunner', sans-serif;
      color: var(--brand);
      letter-spacing: 0.5px;
    }

    .panel {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: var(--pad);
      box-shadow: 0 1px 3px rgba(16, 24, 40, .06);
    }

    /* 상단 바 정렬 */
    .bar {
      display: flex;
      gap: .8rem;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .multi-search-section {
      flex: 1;
      min-width: 320px;
    }

    .cas-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: .5rem;
    }

    input[type="text"] {
      height: var(--btn-h);
      padding: 0 .8rem;
      font-size: 1rem;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #fff;
    }

    input[type="text"]::placeholder {
      color: #9ca3af;
    }

    /* 버튼 공통 */
    .btn {
      height: var(--btn-h);
      padding: 0 1rem;
      background-color: #2563eb;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      font-weight: 600;
      box-shadow: 0 1px 2px rgba(37, 99, 235, .25);
      white-space: nowrap;
    }

    .btn.secondary {
      background: #eef2ff;
      color: #1f2937;
      box-shadow: none;
      border: 1px solid var(--line);
    }

    .btn svg,
    .icon-btn svg {
      width: 18px;
      height: 18px;
      display: block;
    }

    /* + 버튼 */
    .icon-btn {
      width: var(--btn-h);
      height: var(--btn-h);
      background: #eef2ff;
      color: #1f2937;
      border: 1px solid var(--line);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .actions {
      display: grid;
      grid-auto-flow: column;
      gap: .5rem;
      align-items: center;
    }

    /* 업로드 레이어: 왼쪽 정렬 + 수직 가운데 */
    .upload-left {
      display: flex;
      align-items: center;
      gap: .6rem;
      justify-content: flex-start;
      flex: 1 1 auto;
      min-width: 420px;
    }

    .download-side {
      display: flex;
      align-items: center;
      gap: .6rem;
      justify-content: flex-end;
      flex: 0 0 auto;
    }

    .notice {
      color: var(--danger-fg);
      font-size: 0.9rem;
      white-space: nowrap;
    }

    /* ✅ 파일 입력 커스텀 */
    .file-wrap {
      display: flex;
      align-items: center;
      gap: .6rem;
    }

    #excelInput {
      display: none;
    }

    /* 네이티브 입력 숨김 */
    .file-btn {
      height: var(--btn-h);
      padding: 0 1rem;
      background: #eef2ff;
      color: #1f2937;
      border: 1px solid var(--line);
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .file-btn svg {
      width: 18px;
      height: 18px;
      display: block;
    }

    .file-name {
      max-width: 260px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .help-text {
      font-size: .85rem;
      color: var(--muted);
      white-space: nowrap;
    }

    details {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      padding: .15rem .5rem .55rem;
      /* 외부행 여백 살짝 감소 */
      overflow: hidden;
    }

    summary {
      list-style: none;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .75rem;
      padding: .45rem .3rem .3rem;
      /* 슬림화 */
    }

    summary::-webkit-details-marker {
      display: none;
    }

    summary.red {
      color: var(--danger-fg);
    }

    .summary-right {
      display: inline-flex;
      gap: .35rem;
      align-items: center;
      margin-left: auto;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-block;
      font-size: .78rem;
      line-height: 1;
      padding: .35rem .55rem;
      border-radius: 999px;
      border: 1px solid var(--badge-bd);
      background: var(--badge-bg);
      color: var(--badge-fg);
      white-space: nowrap;
    }

    /* 요약줄 CAS 숫자 크게 + 가독성 폰트 */
    .summary-cas {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 1.12rem;
      letter-spacing: .2px;
    }

    /* 테이블 래퍼: 스크롤바 없이 깔끔(내용은 말줄임) */
    .table-wrap {
      width: 100%;
      overflow: hidden;
      /* 스크롤바 제거 */
      border-radius: 8px;
      border: 1px solid var(--line);
      background: #fff;
    }

    table {
      width: 100%;
      /* 가로폭 100%로 맞춤 */
      border-collapse: collapse;
      table-layout: fixed;
      /* 셀 너비 고정 → 말줄임으로 정돈 */
      font-size: var(--table-font);
    }

    /* 각 열 상대 너비 */
    col.cas {
      width: 12%;
    }

    col.group {
      width: 10%;
    }

    col.code {
      width: 12%;
    }

    col.name {
      width: 20%;
    }

    col.issue {
      width: 12%;
    }

    col.ncis {
      width: 8%;
    }

    col.hazard {
      width: 10%;
    }

    col.reagent {
      width: 10%;
    }

    col.toxicimp {
      width: 10%;
    }

    col.restrict {
      width: 12%;
    }

    col.memo {
      width: 10%;
    }

    th,
    td {
      border-bottom: 1px solid var(--line);
      padding: .55rem .6rem;
      vertical-align: middle;
    }

    thead th {
      background-color: #f3f4f6;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    /* 모든 내부행 기본 배경 연하게 통일 */
    tbody td {
      background: var(--row-base);
    }

    tbody tr:hover td {
      background: var(--row-hover);
    }

    /* 셀 정리 */
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .center {
      text-align: center;
    }

    .nowrap {
      white-space: nowrap;
    }

    .ellipsis {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .danger {
      color: var(--danger-fg);
      background: var(--danger-bg) !important;
      font-weight: 700;
    }

    .not-found {
      background: #fff0f0;
      color: var(--danger-fg);
      border: 1px solid #fca5a5;
      padding: 1rem;
      margin-top: 2rem;
      border-radius: 8px;
    }

    .header-wrap {
      position: relative;
    }

    .erp-date {
      position: absolute;
      top: 0;
      right: 0;
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: #fff;
      color: #374151;
      font-size: .92rem;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .04);
    }

    .erp-date strong {
      font-weight: 700;
      letter-spacing: .2px;
    }

    .erp-date svg {
      width: 16px;
      height: 16px;
      color: #6b7280;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="data.js"></script>
</head>

<body>
  <div class="header-wrap">
    <h1 onclick="location.reload()">
      <span class="chemone">CHEMONE</span> 품목 조회
    </h1>

    <div class="erp-date" aria-label="ERP 업데이트 날짜">
      <!-- calendar icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      ERP 업데이트: <strong id="erpDateText">2025-11-03</strong>
    </div>
  </div>


  <!-- 상단 입력/액션 -->
  <div class="panel bar">
    <div class="multi-search-section">
      <div id="casContainer">
        <div class="cas-row">
          <input type="text" class="casInput" placeholder="CAS No. 입력 (공백/콤마/세미콜론/줄바꿈으로 다중검색)" />
          <button class="icon-btn" onclick="addCASInput()" aria-label="입력칸 추가">
            <!-- plus icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn" onclick="applyMultipleCASSearch()">
        <!-- search icon -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="7"></circle>
          <path d="M20 20l-3.5-3.5" stroke-linecap="round" />
        </svg>
        검색
      </button>
      <button class="btn secondary" onclick="applyReset()">
        <!-- reset/refresh icon -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 3-6.7" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M3 4v4h4" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        초기화
      </button>
    </div>
  </div>

  <!-- 업로드 + 안내/다운로드 -->
  <div class="panel bar" style="margin-top:.8rem;">
    <!-- 왼쪽: 커스텀 파일선택 + 파일명 + 안내 텍스트(오른쪽 배치) -->
    <div class="upload-left">
      <div class="file-wrap">
        <label for="excelInput" class="file-btn" id="chooseFileBtn" aria-label="파일 선택">
          <!-- upload icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M5 21h14" stroke-linecap="round" />
          </svg>
          파일 선택
        </label>
        <span id="fileName" class="file-name">선택된 파일 없음</span>
        <input type="file" id="excelInput" accept=".xlsx,.xls,.csv" />
      </div>
      <div class="help-text">CAS 엑셀 파일을 업로드해주세요</div>
    </div>
    <!-- 오른쪽: 안내 문구 + 다운로드 버튼 -->
    <div class="download-side">
      <div class="notice">*빨간색 셀은 유해/유독/제한 키워드에 해당합니다.</div>
      <button class="btn" onclick="downloadExcel()">
        <!-- download icon -->
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M5 21h14" stroke-linecap="round" />
        </svg>
        엑셀 다운로드
      </button>
    </div>
  </div>

  <div id="resultsContainer" style="margin-top:1rem;"></div>

  <script>
    // Enter로 검색
    document.getElementById('casContainer').addEventListener('keydown', e => {
      if (e.key === 'Enter' && e.target.classList.contains('casInput')) {
        e.preventDefault(); applyMultipleCASSearch();
      }
    });

    const resultsContainer = document.getElementById('resultsContainer');
    let filteredData = [];

    // 키 찾기(공백 무시)
    const findKey = (obj, targetKey) =>
      Object.keys(obj).find(k => k.replace(/\s/g, '').toLowerCase() === targetKey.replace(/\s/g, '').toLowerCase());

    const addCASInput = () => {
      const div = document.createElement('div');
      div.className = 'cas-row';
      div.innerHTML = `
        <input type="text" class="casInput" placeholder="CAS No. 입력" />
        <button class="icon-btn" onclick="this.parentNode.remove()" aria-label="입력칸 삭제">
          <!-- minus icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>`;
      document.getElementById('casContainer').appendChild(div);
    };

    // CAS 정규화
    const CAS_REGEX = /(\d{2,}-\d{2}-\d)\b/;
    function normalizeCAS(s) {
      const txt = String(s || '').toLowerCase().trim();
      const m = txt.match(CAS_REGEX);
      return m ? m[1] : txt;
    }

    // 다중 검색어 분리 + 정규화
    function tokenizeCAS(text) {
      return (text || '')
        .split(/[\s,;]+/)
        .map(s => normalizeCAS(s))
        .map(s => s.trim())
        .filter(Boolean);
    }
    const unique = arr => Array.from(new Set(arr));

    // 위험 단어
    const isDangerVal = val =>
      ['유해', '유독', '금지', '불가', '제한', '!!', '잔류'].some(word => String(val ?? '').includes(word));

    function isDangerGroup(items) {
      const fields = [
        '유해화학물판매업신고',
        '유해화학물시약판매업신고',
        '유독물수입신고',
        '제한물질수입신고',
        '품목그룹',
        'NCIS'
      ];
      return items.some(item =>
        fields.some(f => {
          const k = findKey(item, f);
          return k && isDangerVal(item[k]);
        })
      );
    }

    // 뱃지 빌더
    function buildODateBadgeText(label, values) {
      if (!values || values.length === 0) return '';
      const hasO = values.some(v => /^o$/i.test(String(v).trim()));
      const dateMatches = unique(values.flatMap(v => String(v).match(/\b\d{6,8}\b/g) || []));
      const parts = [];
      if (hasO) parts.push('O');
      if (dateMatches.length > 0) parts.push(dateMatches.join(' / '));
      return parts.length ? `${label} : ${parts.join(', ')}` : '';
    }
    const buildHazardBadgeText = v => buildODateBadgeText('유해화학물판매업신고', v);
    const buildReagentBadgeText = v => buildODateBadgeText('유해화학물시약판매업신고', v);
    const buildToxicImportBadgeText = v =>
      v && v.length ? `유독물수입신고 : ${unique(v.map(x => String(x).trim())).join(' / ')}` : '';

    // 제한물질수입신고 셀에 Purity 붙여 렌더
    function renderRestrictedWithPurity(item) {
      const kRestricted = findKey(item, '제한물질수입신고');
      const kPurity = findKey(item, 'Purity');
      const restricted = kRestricted ? String(item[kRestricted] ?? '').trim() : '';
      const purity = kPurity ? String(item[kPurity] ?? '').trim() : '';
      return `${restricted}${purity ? ` (${purity})` : ''}`.trim();
    }

    // 검색 실행 (데이터 CAS도 정규화해서 비교)
    function applyMultipleCASSearch() {
      const inputs = document.querySelectorAll('.casInput');
      const keywords = Array.from(inputs).flatMap(i => tokenizeCAS(i.value)).filter(Boolean);
      const uniqueKeywords = unique(keywords);

      const matchedSet = new Set();
      filteredData = window.DATA.filter(item => {
        const key = findKey(item, 'CAS No.');
        const raw = key ? item[key]?.toString() : '';
        const valueNorm = normalizeCAS(raw);
        const matched = uniqueKeywords.includes(valueNorm);
        if (matched) matchedSet.add(valueNorm);
        return matched;
      });

      const unmatched = uniqueKeywords.filter(kw => !matchedSet.has(kw));
      renderAccordion(unmatched);
    }

    // 아코디언 렌더 (정규화된 CAS로 그룹핑)
    function renderAccordion(unmatchedCAS = []) {
      resultsContainer.innerHTML = '';
      if (filteredData.length === 0) resultsContainer.innerHTML = '<p>검색 결과가 없습니다.</p>';

      const grouped = {};
      filteredData.forEach(item => {
        const casKey = findKey(item, 'CAS No.');
        const raw = casKey ? (item[casKey] || '') : '';
        const casNorm = normalizeCAS(raw) || '[cas 없음]';
        if (!grouped[casNorm]) grouped[casNorm] = [];
        grouped[casNorm].push(item);
      });

      let groups = Object.entries(grouped).map(([casNorm, items]) => ({
        cas: casNorm, items, danger: isDangerGroup(items)
      }));
      groups.sort((a, b) => (a.danger === b.danger ? a.cas.localeCompare(b.cas, 'ko') : a.danger ? -1 : 1));

      // 헤더
      const header = [
        'CAS No.',
        '품목그룹',
        '품목코드',
        '품목명',
        '품목이슈',
        'NCIS',
        '유해화학물판매업신고',
        '유해화학물 시약판매업신고',
        '유독물수입신고',
        '제한물질수입신고(Purity)',
        '비고'
      ];

      groups.forEach(({ cas, items, danger }) => {
        // 요약 뱃지
        const hazardVals = collectFieldValues(items, '유해화학물판매업신고');
        const reagentVals = collectFieldValues(items, '유해화학물시약판매업신고');
        const toxicVals = collectFieldValues(items, '유독물수입신고');

        const hazardBadge = buildHazardBadgeText(hazardVals);
        const reagentBadge = buildReagentBadgeText(reagentVals);
        const toxicBadge = buildToxicImportBadgeText(toxicVals);

        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.className = danger ? 'red' : '';
        summary.innerHTML = `
          <span class="nowrap">
            <strong>CAS No.:</strong>
            <span class="summary-cas">${cas}</span>
            <span style="color:var(--muted); font-weight:500;">(${items.length}개)</span>
          </span>
          <span class="summary-right">
            ${hazardBadge ? `<span class="badge">${hazardBadge}</span>` : ''}
            ${reagentBadge ? `<span class="badge">${reagentBadge}</span>` : ''}
            ${toxicBadge ? `<span class="badge">${toxicBadge}</span>` : ''}
          </span>
        `;
        details.appendChild(summary);

        // 표
        const tableWrap = document.createElement('div');
        tableWrap.className = 'table-wrap';

        const table = document.createElement('table');
        table.innerHTML = `
          <colgroup>
            <col class="cas"><col class="group"><col class="code"><col class="name"><col class="issue">
            <col class="ncis"><col class="hazard"><col class="reagent"><col class="toxicimp"><col class="restrict"><col class="memo">
          </colgroup>
          <thead><tr>${header.map(h => `<th>${h}</th>`).join('')}</tr></thead>
          <tbody></tbody>
        `;

        const tbody = table.querySelector('tbody');

        items.forEach(item => {
          const row = document.createElement('tr');
          header.forEach((h, idx) => {
            const td = document.createElement('td');

            // 열 스타일
            if (idx === 0 || idx === 2) td.classList.add('mono', 'center', 'ellipsis'); // CAS, 품목코드
            if ([1, 5, 6, 7, 8, 9, 10].includes(idx)) td.classList.add('center', 'ellipsis');
            if (idx === 3 || idx === 4) td.classList.add('ellipsis'); // 품목명/이슈

            if (/^제한물질수입신고/i.test(h)) {
              const combined = renderRestrictedWithPurity(item);
              td.innerHTML = combined;
              td.title = combined;
              if (isDangerVal(combined)) td.classList.add('danger');
              row.appendChild(td);
              return;
            }

            const k = findKey(item, h);
            const val = k ? (item[k] ?? '') : '';
            td.innerHTML = val;
            td.title = String(val);
            if (isDangerVal(val)) td.classList.add('danger');
            row.appendChild(td);
          });
          tbody.appendChild(row);
        });

        tableWrap.appendChild(table);
        details.appendChild(tableWrap);
        resultsContainer.appendChild(details);
      });

      if (unmatchedCAS.length > 0) {
        const nf = document.createElement('div');
        nf.className = 'not-found';
        nf.innerHTML = '<strong>검색되지 않은 CAS No.:</strong><br>' + unmatchedCAS.join(', ');
        resultsContainer.appendChild(nf);
      }
    }

    // 값 수집
    function collectFieldValues(items, fieldName) {
      const vals = items.map(it => {
        const k = findKey(it, fieldName);
        return k ? String(it[k] ?? '').trim() : '';
      }).filter(v => v.length > 0);
      return unique(vals);
    }

    // 엑셀 다운로드
    const downloadExcel = () => {
      if (filteredData.length === 0) return alert('데이터가 없습니다.');
      const ws = XLSX.utils.json_to_sheet(filteredData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, '검색결과');
      XLSX.writeFile(wb, '검색결과.xlsx');
    };

    // 초기화
    const applyReset = () => {
      document.getElementById('casContainer').innerHTML = `
        <div class="cas-row">
          <input type="text" class="casInput" placeholder="CAS No. 입력 (공백/콤마/세미콜론/줄바꿈으로 다중검색)" />
          <button class="icon-btn" onclick="addCASInput()" aria-label="입력칸 추가">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>`;
      filteredData = [];
      resultsContainer.innerHTML = '';
      // 파일 입력 초기화 + 파일명 라벨 복구
      const inp = document.getElementById('excelInput');
      const fn = document.getElementById('fileName');
      if (inp) inp.value = '';
      if (fn) fn.textContent = '선택된 파일 없음';
    };

    // 업로드 처리
    document.getElementById('excelInput').addEventListener('change', e => {
      const file = e.target.files[0];

      // ▼ 파일명 라벨 업데이트
      const fn = document.getElementById('fileName');
      if (fn) fn.textContent = file ? file.name : '선택된 파일 없음';

      if (!file) return;
      const reader = new FileReader();
      reader.onload = evt => {
        const data = evt.target.result;
        const arr = new Uint8Array(data);
        const workbook = XLSX.read(arr, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        const values = rows.flat().map(v => v?.toString() ?? '');
        applyCASFilter(values);
      };
      reader.readAsArrayBuffer(file);
    });

    // 업로드 목록 필터링
    function applyCASFilter(casListRaw) {
      const tokens = unique(casListRaw.flatMap(v => tokenizeCAS(v)));
      const matchedSet = new Set();
      filteredData = window.DATA.filter(item => {
        const key = findKey(item, 'CAS No.');
        const raw = key ? item[key]?.toString() : '';
        const valueNorm = normalizeCAS(raw);
        const matched = tokens.includes(valueNorm);
        if (matched) matchedSet.add(valueNorm);
        return matched;
      });
      const unmatched = tokens.filter(kw => !matchedSet.has(kw));
      renderAccordion(unmatched);
    }

    // 필요 시 여기만 바꾸면 화면에 자동 반영됩니다.
    document.getElementById('erpDateText').textContent = '2025-11-03';

  </script>
</body>

</html>
